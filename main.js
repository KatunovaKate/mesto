(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n=function(){function n(e,o,r,u,i,c,s){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t(this,"setLike",(function(e){a._element.querySelector(".element__number-of-likes").textContent=a._likes.length+1,a._element.querySelector(".element__like-button").classList.add("element__like-button_active")})),t(this,"deleteLike",(function(e){a._element.querySelector(".element__number-of-likes").textContent="".concat(a._likes.length)-1,a._element.querySelector(".element__like-button").classList.remove("element__like-button_active")})),t(this,"delClickHandler",(function(e){a._api.deleteTask(e).then((function(){a._element.remove()})).catch((function(e){return console.log(e)}))})),t(this,"_removeDeleteButton",(function(e){e!=a._myId&&a._element.querySelector(".element__delete-button").classList.add("element__delete-button_remove")})),t(this,"_numberOfLikes",(function(e){console.log(e),a._element.querySelector(".element__number-of-likes").textContent=e.length})),t(this,"_likeToggle",(function(e){e.find((function(e){return e._id===a._myId}))&&a._element.querySelector(".element__like-button").classList.add("element__like-button_active")})),this._name=e.name,this._link=e.link,this._likes=e.likes,this._cardSelector=o,this._handleCardClick=r,this._deletePopup=u,this._handleCardLike=i,this._api=c,this._myId=s,this._cardElement=document.querySelector(this._cardSelector),this._likeButton=this._cardElement.querySelector(".element__like-button")}var o,r;return o=n,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__like-button").addEventListener("click",(function(t){e._handleCardLike()})),this._element.querySelector(".element__image").addEventListener("click",(function(){e._handleCardClick()})),this._element.querySelector(".element__delete-button").addEventListener("click",(function(){e._deletePopup()}))}},{key:"renderCard",value:function(e,t){this._element=this._getTemplate(),this._removeDeleteButton(e),this._numberOfLikes(t),this._likeToggle(t),this._setEventListeners();var n=this._element.querySelector(".element__image");return n.style.backgroundImage="url(".concat(this._link,")"),this._element.querySelector(".element__title").textContent=this._name,n.setAttribute("alt","".concat(this._name)),this._element}}])&&e(o.prototype,r),n}(),o=(Array.from(document.querySelectorAll(".popup")),document.querySelector(".popup_class_edit"),document.querySelector(".popup__form_class_edit")),r=document.querySelector(".profile__edit-button"),u=document.querySelector(".popup__close-button_class_edit"),i=document.querySelector(".popup__form-name_class_edit"),c=document.querySelector(".popup__form-description_class_edit"),s=document.querySelector(".profile__username"),a=document.querySelector(".profile__user-description"),l=document.querySelector(".profile__avatar"),p=document.querySelector(".popup__save-button_change-photo"),f=(document.querySelector(".popup_class_add"),document.querySelector(".popup__save-button_class_add")),_=document.querySelector(".popup__form_class_add"),m=document.querySelector(".profile__add-button"),h=(document.querySelector(".popup__close-button_class_add"),document.querySelector(".popup__form-name_class_add")),d=document.querySelector(".popup__form-description_class_add"),y=(document.querySelector(".popup_class_image-show"),document.querySelector(".popup__close-button_class_image-show"),document.querySelector(".popup__form_class_change-photo")),v=(document.querySelector(".popup__close-button_class_change-photo"),document.querySelector(".popup__save-button_change-photo"),document.querySelector(".profile__edit-photo")),b=(document.querySelector(".popup__save-button_class_remove"),document.querySelector(".template"),document.querySelector(".elements__list")),S=(document.querySelector(".element__image"),document.querySelector(".element__title"),document.querySelector(".element__delete-button"),document.querySelector(".popup__image"),document.querySelector(".popup__image-text"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_type_disable",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_type_active"});function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"_hasInvalidInput",(function(){return o._inputList.some((function(e){return!e.validity.valid}))})),g(this,"changeButtonState",(function(){o._hasInvalidInput()?(o._buttonElement.classList.add(o._inactiveButtonClass),o._buttonElement.setAttribute("disabled","disabled")):(o._buttonElement.classList.remove(o._inactiveButtonClass),o._buttonElement.removeAttribute("disabled"))})),g(this,"_showError",(function(e,t){o._errorElement.textContent=t.validationMessage,o._errorElement.classList.add(o._errorClass),t.classList.add(o._inputErrorClass)})),g(this,"_hideError",(function(e,t){o._errorElement.textContent="",o._errorElement.classList.remove(o._errorClass),t.classList.remove(o._inputErrorClass)})),g(this,"_checkValidity",(function(e,t){t.validity.valid?o._hideError(e,t):o._showError(e,t)})),g(this,"_setIventListerners",(function(e){o._formElement.addEventListener("submit",(function(e){e.preventDefault()})),o._inputList.forEach((function(t){t.addEventListener("input",(function(){o._checkValidity(e,t),o.changeButtonState()}))})),o.changeButtonState()})),g(this,"enableValidation",(function(){o._setIventListerners(o._formElement)})),this._formElement=n,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inputList=Array.from(n.querySelectorAll(this._inputSelector)),this._buttonElement=n.querySelector(this._submitButtonSelector),this._errorElement=this._formElement.querySelector("".concat(this._inputSelector,"-error"))};function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var w=function(){function e(t,n,o){var r=t.items,u=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=u,this._container=n,this._api=o}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._items.forEach((function(t){return e._renderer(t)}))}},{key:"setItem",value:function(e){this._container.prepend(e)}}])&&E(t.prototype,n),e}();function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var q=function(){function e(t){var n,o,r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=function(e){"Escape"===e.key&&r.closePopup()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[n]=o,this._popup=document.querySelector(t),this._closeButton=this._popup.querySelector(".popup__close-button")}var t,n;return t=e,(n=[{key:"openPopup",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"closePopup",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this._closeButton.addEventListener("click",(function(){return e.closePopup()})),this._popup.addEventListener("mousedown",(function(t){t.target===t.currentTarget&&e.closePopup()}))}}])&&C(t.prototype,n),e}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(i,e);var t,n,o,r,u=(o=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(o);if(r){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return I(this,e)});function i(e){var t,n=e.popupSelector,o=e.submitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=u.call(this,n))._submitForm=o,t._inputList=Array.from(t._popup.querySelectorAll(".popup__input")),t._formElement=t._popup.querySelector(".popup__form"),t}return t=i,(n=[{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._submitForm(e._getInputValues())})),O(T(i.prototype),"setEventListeners",this).call(this)}},{key:"closePopup",value:function(){this._formElement.reset(),O(T(i.prototype),"closePopup",this).call(this)}}])&&P(t.prototype,n),i}(q);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function A(e,t,n){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(i,e);var t,n,o,r,u=(o=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(o);if(r){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return D(this,e)});function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=u.call(this,e))._popupImage=t._popup.querySelector(".popup__image"),t._popupName=t._popup.querySelector(".popup__image-text"),t}return t=i,(n=[{key:"openPopup",value:function(e,t){this._popupImage.src=e,this._popupName.textContent=t,this._popupImage.alt=t,A(U(i.prototype),"openPopup",this).call(this)}}])&&R(t.prototype,n),i}(q);function F(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var H=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameSelector=document.querySelector(t),this._subSelector=document.querySelector(n),this._api=o}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(e){var t=e.name,n=e.about;return this.profileInfo={},this.profileInfo.nameSelector=t,this.profileInfo.subSelector=n,this.profileInfo}},{key:"setUserInfo",value:function(e){var t=e.formUserName,n=e.formDescription;this._nameSelector.textContent=t,this._subSelector.textContent=n}}])&&F(t.prototype,n),e}();function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var G=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.url,this._headers=t.headers,this.about=t.about,this.name=t.name,this.avatar=t.avatar}var t,n;return t=e,(n=[{key:"getCards",value:function(){return fetch(this._url+"cards",{method:"GET",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"getInfo",value:function(){return fetch(this._url+"users/me",{method:"GET",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;return fetch(this._url+"users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"setAvatar",value:function(e){var t=e.avatar;return fetch(this._url+"users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"addCard",value:function(e){return fetch(this._url+"cards",{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"deleteTask",value:function(e){return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"setLike",value:function(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:this._headers,body:JSON.stringify({_id:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}},{key:"deletelike",value:function(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}}])&&J(t.prototype,n),e}())({url:"https://mesto.nomoreparties.co/v1/cohort-29/",headers:{"Content-Type":"application/json",authorization:"599d58cc-8009-4c2f-8eaa-205713197ccb"}}),z=new B({popupSelector:".popup_class_change-photo",submitForm:function(e){p.textContent="Сохранение...",G.setAvatar({avatar:e.image}).then((function(e){l.src="".concat(e.avatar)})).finally((function(){p.textContent="Сохранить"})),p.classList.add("popup__save-button_type_disable"),X.changeButtonState(),z.closePopup()}});v.addEventListener("click",(function(){X.changeButtonState(),z.openPopup()})),z.setEventListeners();var M=null;G.getInfo().then((function(e){var t=e.name,n=e.about,o=e.avatar,r=e._id,u=K.getUserInfo({name:t,about:n});s.textContent=u.nameSelector,a.textContent=u.subSelector,l.src="".concat(o),M="".concat(r)}));var K=new H(".profile__username",".profile__user-description",G),Q=new B({popupSelector:".popup_class_edit",submitForm:function(e){u.textContent="Сохранение...",G.setUserInfo({name:e.username,about:e.description}).then((function(e){K.setUserInfo({formUserName:e.name,formDescription:e.about}),Q.closePopup()})).finally((function(){u.textContent="Сохранить"}))}});Q.setEventListeners(),r.addEventListener("click",(function(){Q.openPopup(),G.getInfo().then((function(e){var t=e.name,n=e.about,o=K.getUserInfo({name:t,about:n});i.value=o.nameSelector,c.value=o.subSelector}))})),G.getCards().then((function(e){var t=function(t){var o=new n(t,".template",(function(){W.openPopup(t.link,t.name)}),(function(){var n=new B({popupSelector:".popup_class_remove",submitForm:function(){e.map((function(e){return{id:e.id}})),o.delClickHandler(t._id),n.closePopup()}});n.setEventListeners(),n.openPopup()}),(function(){t.likes.find((function(e){return e._id===M}))?G.deletelike(t._id).then((function(){o.deleteLike(t._id)})):G.setLike(t._id).then((function(){o.setLike(t._id)}))}),G,M);return o.renderCard(t.owner._id,t.likes)},o=new w({items:e,renderer:function(e){b.append(t(e))}},b,G);o.renderItems();var r=new B({popupSelector:".popup_class_add",submitForm:function(){f.textContent="Создание...",G.addCard({name:h.value,link:d.value}).then((function(e){console.log(e),o.setItem(t(e))})),f.classList.add("popup__save-button_type_disable"),X.changeButtonState(),r.closePopup(),f.textContent="Создать"}});m.addEventListener("click",(function(){X.changeButtonState(),r.openPopup()})),r.setEventListeners()}));var W=new N(".popup_class_image-show");W.setEventListeners(),new k(S,o).enableValidation();var X=new k(S,_);X.enableValidation(),new k(S,y).enableValidation()})();
//# sourceMappingURL=main.js.map